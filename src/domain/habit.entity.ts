import { HabitFrequency, DifficultyLevel } from './types';

/**
 * –ö–ª–∞—Å Habit (–°—É—Ç–Ω—ñ—Å—Ç—å –ó–≤–∏—á–∫–∏).
 * –ü—Ä–µ–¥—Å—Ç–∞–≤–ª—è—î –æ—Å–Ω–æ–≤–Ω—É –æ–¥–∏–Ω–∏—Ü—é –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏ –≤ —Å–∏—Å—Ç–µ–º—ñ —Ç—Ä–µ–∫–µ—Ä–∞ –∑–≤–∏—á–æ–∫.
 * * –¶–µ–π –∫–ª–∞—Å –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∑–∞ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —Å—Ç–∞–Ω—É –∑–≤–∏—á–∫–∏, —ó—ó –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å (—á–∞—Å—Ç–æ—Ç–∞, —Å–∫–ª–∞–¥–Ω—ñ—Å—Ç—å)
 * —Ç–∞ –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –ø—Ä–æ–≥—Ä–µ—Å—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (–ø–æ—Ç–æ—á–Ω–∏–π —Å—Ç—Ä—ñ–∫).
 */
export class Habit {
    /** –£–Ω—ñ–∫–∞–ª—å–Ω–∏–π —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –∑–≤–∏—á–∫–∏ (UUID) */
    public id: string;
    
    /** ID –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, —è–∫–æ–º—É –Ω–∞–ª–µ–∂–∏—Ç—å –∑–≤–∏—á–∫–∞ */
    public userId: string;
    
    /** –ù–∞–∑–≤–∞ –∑–≤–∏—á–∫–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, "–ü–∏—Ç–∏ –≤–æ–¥—É") */
    public name: string;
    
    /** –ö–∞—Ç–µ–≥–æ—Ä—ñ—è –∑–≤–∏—á–∫–∏ (–ó–¥–æ—Ä–æ–≤'—è, –ù–∞–≤—á–∞–Ω–Ω—è, –†–æ–±–æ—Ç–∞ —Ç–æ—â–æ) */
    public category: string;
    
    /** –ß–∞—Å—Ç–æ—Ç–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è (–©–æ–¥–Ω—è, –†–∞–∑ –Ω–∞ —Ç–∏–∂–¥–µ–Ω—å, –ü–æ –±—É–¥–Ω—è—Ö) */
    public frequency: HabitFrequency;
    
    /** * –†—ñ–≤–µ–Ω—å —Å–∫–ª–∞–¥–Ω–æ—Å—Ç—ñ (–≤—ñ–¥ 1 –¥–æ 5).
     * –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É Discipline Score.
     * 1 = –õ–µ–≥–∫–æ, 5 = –ï–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–æ –≤–∞–∂–∫–æ.
     */
    public difficulty: number; // 1-5
    
    /** –î–Ω—ñ —Ç–∏–∂–Ω—è, –∫–æ–ª–∏ –∑–≤–∏—á–∫–∞ –º–∞—î –±—É—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω–∞ (0 = –ù–µ–¥—ñ–ª—è, 1 = –ü–æ–Ω–µ–¥—ñ–ª–æ–∫...) */
    public reminderDays: number[];

    /** * –ü–æ—Ç–æ—á–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –¥–Ω—ñ–≤ –ø–æ—Å–ø—ñ–ª—å –±–µ–∑ –ø—Ä–æ–ø—É—Å–∫—ñ–≤.
     * –ó–±—ñ–ª—å—à—É—î—Ç—å—Å—è –ø—Ä–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—ñ, —Å–∫–∏–¥–∞—î—Ç—å—Å—è –Ω–∞ 0 –ø—Ä–∏ –ø—Ä–æ–ø—É—Å–∫—É.
     */
    public currentStreak: number;

    /**
     * –û—Å—Ç–∞–Ω–Ω—ñ–π –∑–∞—Ñ—ñ–∫—Å–æ–≤–∞–Ω–∏–π —Å—Ç—Ä—ñ–∫ –ø–µ—Ä–µ–¥ –ø—Ä–æ–ø—É—Å–∫–æ–º.
     * –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –≥–µ–π–º—ñ—Ñ—ñ–∫–∞—Ü—ñ—ó (–≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è "—Ä–æ–∑–±–∏—Ç–æ–≥–æ —Å–µ—Ä—Ü—è" üíî).
     */
    public lastStreak: number = 0;

    /** –î–∞—Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–ø–∏—Å—É */
    public createdAt: Date;

    /**
     * –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∫–ª–∞—Å—É Habit.
     * –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î –Ω–æ–≤—É –∑–≤–∏—á–∫—É –∑ –ø–æ—á–∞—Ç–∫–æ–≤–∏–º —Å—Ç—Ä—ñ–∫–æ–º 0.
     * * @param id - –£–Ω—ñ–∫–∞–ª—å–Ω–∏–π ID
     * @param userId - ID –≤–ª–∞—Å–Ω–∏–∫–∞
     * @param name - –ù–∞–∑–≤–∞
     * @param category - –ö–∞—Ç–µ–≥–æ—Ä—ñ—è
     * @param frequency - –ï–Ω–∞–º —á–∞—Å—Ç–æ—Ç–∏
     * @param difficulty - –ß–∏—Å–ª–æ 1-5
     * @param reminderDays - –ú–∞—Å–∏–≤ –¥–Ω—ñ–≤ —Ç–∏–∂–Ω—è [0-6]
     */
    constructor(
        id: string,
        userId: string,
        name: string,
        category: string,
        frequency: HabitFrequency,
        difficulty: number,
        reminderDays: number[]
    ) {
        this.id = id;
        this.userId = userId;
        this.name = name;
        this.category = category;
        this.frequency = frequency;
        this.difficulty = difficulty;
        this.reminderDays = reminderDays;
        this.currentStreak = 0;
        this.lastStreak = 0;
        this.createdAt = new Date();
    }

    /**
     * –ü–µ—Ä–µ–≤—ñ—Ä—è—î, —á–∏ –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–∞ —Ü—è –∑–≤–∏—á–∫–∞ –Ω–∞ –≤–∫–∞–∑–∞–Ω—É –¥–∞—Ç—É.
     * * –ú–µ—Ç–æ–¥ –æ—Ç—Ä–∏–º—É—î –¥–µ–Ω—å —Ç–∏–∂–Ω—è –∑ –ø–µ—Ä–µ–¥–∞–Ω–æ—ó –¥–∞—Ç–∏ (0-6)
     * —ñ –ø–µ—Ä–µ–≤—ñ—Ä—è—î, —á–∏ –≤—Ö–æ–¥–∏—Ç—å —Ü–µ–π –¥–µ–Ω—å —É –º–∞—Å–∏–≤ reminderDays.
     * * @param date - –î–∞—Ç–∞, –¥–ª—è —è–∫–æ—ó —Ä–æ–±–∏—Ç—å—Å—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞
     * @returns {boolean} true, —è–∫—â–æ –∑–≤–∏—á–∫–∞ –º–∞—î –±—É—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω–∞ –≤ —Ü–µ–π –¥–µ–Ω—å
     */
    public isScheduledForDate(date: Date): boolean {
        const dayOfWeek = date.getDay();
        return this.reminderDays.includes(dayOfWeek);
    }
}